<div class="section border rounded p-3 mb-4" id="section-<%= section.id %>">
  <h4><%= section.description %></h4>

  <div class="line-items" data-section-id="<%= section.id %>" data-controller="line-items">

  <%= link_to "Remove Section", section_path(section), data: { turbo_method: :delete, turbo_confirm: "√ätes-vous s√ªr de vouloir supprimer cette section et toutes ses lignes ?" }, class: "btn btn-sm btn-outline-danger mb-2" %>

    <div class="sticky-header bg-light py-2 mb-2 rounded" style="position: sticky; top: 0; z-index: 100;">
      <div class="row text-center align-items-center">
        <div class="col-auto" style="width: 40px;"></div>
        <div class="col-md-4">Description</div>
        <div class="col-md-1">Quantit√©</div>
        <div class="col-md-1">Unit√©</div>
        <div class="col-md-2">Prix unitaire</div>
        <div class="col-md-2">Prix total</div>
      </div>
    </div>

    <div data-controller="line-items-sort"
         data-line-items-sort-url-value="<%= reorder_line_items_path %>">

      <div data-line-items-sort-target="list" id="<%= section.id %>-line-items">
        <% section.line_items.order(:position).each do |line_item| %>
          <div data-id="<%= line_item.id %>" class="draggable-line-item">
            <%= render "quotes/line_item", line_item: line_item %>
          </div>
        <% end %>
      </div>
    </div>

    <%= render "quotes/line_item", line_item: section.line_items.new %>

    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Ajouter des √©l√©ments par IA</h5>
        <div data-controller="audio-recorder">
          <%= simple_form_for :transcript, url: add_line_items_with_llm_section_path(section) do |f| %>
            <%= f.input :text,
                          label: "D√©crivez les √©l√©ments √† ajouter (vous pouvez aussi utiliser le micro) :",
                          required: false,
                          input_html: { data: { "audio-recorder-target": "textArea" }, rows: 3, class: "form-control-sm" },
                          placeholder: "Ex: 2h de pon√ßage et mise en peinture de 5m¬≤ de mur en blanc...",
                          label_html: { class: "form-label" } %>

            <div class="d-flex gap-2 align-items-center mt-2">
              <%= f.submit 'Analyser la description', class: "btn btn-primary btn-sm" %>

              <button type="button"
                      data-action="click->audio-recorder#toggle"
                      data-audio-recorder-target="recordButton"
                      class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-mic-fill"></i>
              </button>

              <span data-audio-recorder-target="status" class="text-danger small" style="display: none;">
                üî¥ Enregistrement...
              </span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
