<div class="container py-5">
  <h2 class="mb-5 text-center display-6">🛠 <%= @quote.title %> </h2>

  <!-- Bloc description texte uniquement -->
  <div class="mb-4">
    <label class="form-label fw-semibold" for="description_field">
      Description du chantier
    </label>
    <textarea id="description_field" name="quote[description]" class="form-control" rows="3" placeholder="Décrivez le chantier..."></textarea>
  </div>
  <!-- Fin bloc description texte uniquement -->

  <div class="d-flex flex-column gap-4">
    <% @quote.ai_messages.each do |msg| %>
      <!-- Message utilisateur -->
      <% if msg.role == "user" %>
        <div class="d-flex justify-content-start">
          <div class="bg-white border rounded shadow-sm px-4 py-3" style="max-width: 60%;">
            <div class="text-dark"><%= raw(msg.description) %></div>
          </div>
        </div>
      <% elsif msg.role == "assistant" %>
        <!-- Réponse IA -->
        <div class="d-flex justify-content-end">
          <div class="bg-light border rounded shadow-sm px-4 py-3" style="max-width: 60%;">
            <div class="text-dark text-end"><%= raw(msg.description) %></div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Formulaire "chatbox" -->
  <div class="card shadow-sm mt-5">
    <div class="card-body">
      <h5 class="card-title mb-3 text-center">Envoyer un nouveau message</h5>
      <%= form_with model: [@quote, AiMessage.new], local: true do |form| %>
        <div class="input-group">
          <%= form.text_area :description, rows: 2, class: "form-control", placeholder: "Posez une question à l'IA..." %>
          <button class="btn btn-primary" type="submit">Envoyer</button>
        </div>
      <% end %>
    </div>
  </div>

  <div class="text-center mt-4">
    <%= link_to "← Retour à mes devis", quotes_path, class: "btn btn-outline-secondary" %>
  </div>
</div>
